<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wedgie Vault - Billion Video Archive</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.ethers.io/lib/ethers-6.7.0.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Syncopate:wght@400;700&family=Space+Grotesk:wght@300;500;700&display=swap" rel="stylesheet">

    <style>
        :root { --neon-pink: #ff10f0; --neon-purple: #9d174d; --deep-black: #050505; }
        body { background-color: var(--deep-black); color: #ffffff; font-family: 'Space Grotesk', sans-serif; }
       .neon-text { color: var(--neon-pink); text-shadow: 0 0 10px var(--neon-pink); }
       .neon-border { border: 2px solid var(--neon-pink); box-shadow: 0 0 15px var(--neon-pink); }
       .video-card { background: rgba(20, 20, 20, 0.8); transition: 0.3s ease; cursor: pointer; border: 1px solid #333; }
       .video-card:hover { transform: scale(1.05); border-color: var(--neon-pink); }
       .btn-premium { background: linear-gradient(45deg, var(--neon-pink), var(--neon-purple)); }
        #video-modal { display: none; backdrop-filter: blur(20px); background: rgba(0,0,0,0.95); }
    </style>
</head>
<body class="antialiased">

    <nav class="fixed top-0 w-full z-50 p-6 flex justify-between items-center bg-black/80 backdrop-blur-md border-b border-white/10">
        <h1 class="text-3xl font-bold neon-text" style="font-family: 'Syncopate';">WEDGIE.VAULT</h1>
        <button id="connect-wallet" class="neon-border px-8 py-2 rounded-full text-xs font-bold hover:bg-pink-600 transition-all">
            CONNECT WALLET
        </button>
    </nav>

    <section class="pt-40 pb-20 px-6 text-center">
        <h2 class="text-6xl md:text-8xl font-bold mb-6 italic leading-none">1 BILLION <br><span class="neon-text">Hanging Wedgies</span></h2>
        <p class="text-xl text-gray-400 mb-10 max-w-2xl mx-auto">High-fidelity nerd-justice on the blockchain. Treasury: 0x02f9...cBb</p>
        <button onclick="document.getElementById('archive-grid').scrollIntoView({behavior:'smooth'})" class="btn-premium px-12 py-4 rounded-md font-bold text-lg">ENTER VAULT</button>
    </section>

    <main id="archive-grid" class="max-w-7xl mx-auto py-20 px-6">
        <div id="video-container" class="grid grid-cols-1 md:grid-cols-3 gap-8"></div>
    </main>

    <div id="video-modal" class="fixed inset-0 z- flex items-center justify-center p-6">
        <div class="absolute inset-0" onclick="closePlayer()"></div>
        <div class="relative w-full max-w-4xl bg-zinc-900 rounded-2xl overflow-hidden border border-white/20">
            <div class="aspect-video bg-black relative">
                <video id="player" class="w-full h-full" controls></video>
                <div id="payment-gate" class="absolute inset-0 bg-black/95 flex flex-col items-center justify-center text-center p-8">
                    <h4 class="text-3xl font-bold mb-4">Content Locked</h4>
                    <button id="pay-button" class="btn-premium px-12 py-5 rounded-full text-xl font-bold">PAY 0.001 ETH TO VIEW</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const TREASURY = "0x02f93c7547309ca50EEAB446DaEBE8ce8E694cBb";
        const ADMIN = "0x02f93c7547309ca50EEAB446DaEBE8ce8E694cBb";
        const ELEVEN_LABS_KEY = ""; // Enter your API Key here
        const VOICE_ID = "pNInz6obpgDQGcFmaJgB"; // Enthusiastic Tech Geek

        let provider, signer, userAddress;

        async function initWallet() {
            if (window.ethereum) {
                // Listen for account changes
                window.ethereum.on('accountsChanged', (accounts) => {
                    if (accounts.length > 0) {
                        handleNewAccounts(accounts);
                    } else {
                        location.reload();
                    }
                });

                // Listen for chain changes
                window.ethereum.on('chainChanged', () => location.reload());
            }
        }

        async function connect() {
            if (!window.ethereum) return alert("Install MetaMask!");
            try {
                // Fixed syntax: added empty array for parameters
                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                handleNewAccounts(accounts);
            } catch (err) {
                console.error("Connection failed", err);
            }
        }

        async function handleNewAccounts(accounts) {
            userAddress = accounts;
            provider = new ethers.BrowserProvider(window.ethereum);
            signer = await provider.getSigner();
            
            const btn = document.getElementById('connect-wallet');
            btn.innerText = userAddress.slice(0,6) + "..." + userAddress.slice(-4);
            btn.classList.add('bg-pink-600');

            if (userAddress.toLowerCase() === ADMIN.toLowerCase()) {
                triggerNerdVoice("Master address detected. Accessing the billion-video array. No fees for you.");
            }
        }

        async function triggerNerdVoice(text) {
            if (!ELEVEN_LABS_KEY) return console.log("Nerd says:", text);
            try {
                const response = await fetch(`https://api.elevenlabs.io/v1/text-to-speech/${VOICE_ID}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'xi-api-key': ELEVEN_LABS_KEY },
                    body: JSON.stringify({ text, model_id: "eleven_monolingual_v2" })
                });
                const blob = await response.blob();
                new Audio(URL.createObjectURL(blob)).play();
            } catch (err) { console.error(err); }
        }

        async function handlePayment() {
            if (!userAddress) await connect();
            try {
                const tx = await signer.sendTransaction({
                    to: TREASURY,
                    value: ethers.parseEther("0.001")
                });
                await tx.wait(); // Wait for mining
                document.getElementById('payment-gate').style.display = 'none';
                document.getElementById('player').play();
                triggerNerdVoice("Transaction mined. Enjoy the wedgie.");
            } catch (err) {
                triggerNerdVoice("Payment failed. Are you a broke nerd? Sign the transaction!");
            }
        }

        function openPlayer(video) {
            const modal = document.getElementById('video-modal');
            const gate = document.getElementById('payment-gate');
            modal.style.display = 'flex';
            
            if (userAddress && userAddress.toLowerCase() === ADMIN.toLowerCase()) {
                gate.style.display = 'none';
                document.getElementById('player').play();
            } else {
                gate.style.display = 'flex';
                triggerNerdVoice("This archive is gated. 0.001 ETH, pay up!");
            }
        }

        function closePlayer() {
            document.getElementById('video-modal').style.display = 'none';
            document.getElementById('player').pause();
        }

        document.getElementById('connect-wallet').onclick = connect;
        document.getElementById('pay-button').onclick = handlePayment;
        window.onload = initWallet;
    </script>
</body>
</html>
