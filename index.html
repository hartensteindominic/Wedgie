<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Wedgie Escape</title>
  <style>
    :root {
      --bg: #121426;
      --panel: #1d2140;
      --accent: #ff4fa3;
      --accent-2: #6cf0ff;
      --text: #f4f6ff;
      --danger: #ff6b6b;
      --good: #68f29a;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      display: grid;
      place-items: center;
      font-family: "Trebuchet MS", "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #212850, var(--bg));
      color: var(--text);
      padding: 24px;
    }

    .game-shell {
      width: min(920px, 100%);
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.07), rgba(255, 255, 255, 0.02));
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 18px;
      overflow: hidden;
      box-shadow: 0 18px 45px rgba(0, 0, 0, 0.35);
    }

    .topbar {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
      justify-content: space-between;
      background: var(--panel);
      padding: 16px 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.12);
    }

    .title {
      font-size: 1.4rem;
      font-weight: 800;
      letter-spacing: 0.4px;
    }

    .stats {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .stat {
      padding: 6px 12px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.1);
      font-size: 0.95rem;
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      padding: 12px 20px;
      background: rgba(0, 0, 0, 0.18);
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
      font-size: 0.9rem;
    }

    button {
      border: none;
      border-radius: 10px;
      padding: 10px 14px;
      font-weight: 700;
      color: #111;
      background: linear-gradient(120deg, var(--accent-2), var(--accent));
      cursor: pointer;
      transition: transform 0.15s ease;
    }

    button:hover {
      transform: translateY(-1px);
    }

    canvas {
      display: block;
      width: 100%;
      height: auto;
      background:
        linear-gradient(rgba(255, 255, 255, 0.08) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255, 255, 255, 0.08) 1px, transparent 1px),
        #131936;
      background-size: 28px 28px, 28px 28px, auto;
    }

    .footer {
      padding: 12px 20px 18px;
      font-size: 0.95rem;
      color: rgba(255, 255, 255, 0.9);
    }

    .hint {
      color: var(--accent-2);
      font-weight: 700;
    }
  </style>
</head>
<body>
  <section class="game-shell">
    <div class="topbar">
      <div class="title">ü©≤ Wedgie Escape</div>
      <div class="stats">
        <div class="stat">Score: <strong id="score">0</strong></div>
        <div class="stat">Lives: <strong id="lives">3</strong></div>
        <div class="stat">Level: <strong id="level">1</strong></div>
      </div>
    </div>

    <div class="controls">
      <button id="startBtn">Start / Restart</button>
      <span>Move with <span class="hint">‚Üê ‚Üí</span> or <span class="hint">A D</span>. Catch ‚≠ê snacks, dodge ü©≤ wedgies.</span>
    </div>

    <canvas id="game" width="900" height="520" aria-label="Wedgie Escape game area"></canvas>

    <div class="footer" id="status">Press <strong>Start</strong> to begin your escape run!</div>
  </section>

  <script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');

    const scoreEl = document.getElementById('score');
    const livesEl = document.getElementById('lives');
    const levelEl = document.getElementById('level');
    const statusEl = document.getElementById('status');
    const startBtn = document.getElementById('startBtn');

    const state = {
      running: false,
      score: 0,
      lives: 3,
      level: 1,
      time: 0,
      keys: new Set(),
      player: { x: canvas.width / 2 - 25, y: canvas.height - 70, w: 50, h: 40, speed: 420 },
      hazards: [],
      pickups: [],
      hazardSpawnTimer: 0,
      pickupSpawnTimer: 0,
      levelTimer: 0,
      lastFrame: 0
    };

    function resetGame() {
      state.running = true;
      state.score = 0;
      state.lives = 3;
      state.level = 1;
      state.time = 0;
      state.keys.clear();
      state.player.x = canvas.width / 2 - state.player.w / 2;
      state.hazards = [];
      state.pickups = [];
      state.hazardSpawnTimer = 0;
      state.pickupSpawnTimer = 0;
      state.levelTimer = 0;
      state.lastFrame = performance.now();
      updateUI();
      statusEl.textContent = 'Run! Keep your cool and avoid airborne wedgies!';
      requestAnimationFrame(gameLoop);
    }

    function updateUI() {
      scoreEl.textContent = state.score;
      livesEl.textContent = state.lives;
      levelEl.textContent = state.level;
    }

    function randomX(width) {
      return Math.random() * (canvas.width - width);
    }

    function spawnHazard() {
      const size = 34 + Math.random() * 24;
      state.hazards.push({
        x: randomX(size),
        y: -size,
        w: size,
        h: size,
        speed: 130 + state.level * 38 + Math.random() * 90,
        rotation: Math.random() * Math.PI * 2,
        spin: (Math.random() - 0.5) * 2.4
      });
    }

    function spawnPickup() {
      const size = 22;
      state.pickups.push({
        x: randomX(size),
        y: -size,
        w: size,
        h: size,
        speed: 140 + Math.random() * 65,
        bob: Math.random() * Math.PI * 2
      });
    }

    function rectOverlap(a, b) {
      return a.x < b.x + b.w && a.x + a.w > b.x && a.y < b.y + b.h && a.y + a.h > b.y;
    }

    function drawPlayer() {
      const p = state.player;
      ctx.save();
      ctx.translate(p.x + p.w / 2, p.y + p.h / 2);
      ctx.fillStyle = '#ffe9c9';
      ctx.fillRect(-18, -12, 36, 26);
      ctx.beginPath();
      ctx.arc(0, -26, 14, 0, Math.PI * 2);
      ctx.fill();
      ctx.fillStyle = '#25203f';
      ctx.fillRect(-20, 10, 40, 18);
      ctx.fillStyle = '#6cf0ff';
      ctx.fillRect(-18, 10, 36, 10);
      ctx.restore();
    }

    function drawHazard(h) {
      ctx.save();
      ctx.translate(h.x + h.w / 2, h.y + h.h / 2);
      ctx.rotate(h.rotation);
      ctx.font = `${Math.floor(h.w)}px serif`;
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText('ü©≤', 0, 0);
      ctx.restore();
    }

    function drawPickup(p) {
      ctx.save();
      ctx.translate(p.x + p.w / 2, p.y + p.h / 2 + Math.sin(p.bob) * 4);
      ctx.font = `${Math.floor(p.w)}px serif`;
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText('‚≠ê', 0, 0);
      ctx.restore();
    }

    function drawHud() {
      if (!state.running && state.lives <= 0) {
        ctx.fillStyle = 'rgba(0, 0, 0, 0.55)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = '#fff';
        ctx.textAlign = 'center';
        ctx.font = 'bold 52px Trebuchet MS';
        ctx.fillText('Game Over!', canvas.width / 2, canvas.height / 2 - 20);
        ctx.font = '28px Trebuchet MS';
        ctx.fillText(`Final Score: ${state.score}`, canvas.width / 2, canvas.height / 2 + 28);
      }
    }

    function update(dt) {
      const p = state.player;
      if (state.keys.has('ArrowLeft') || state.keys.has('a') || state.keys.has('A')) {
        p.x -= p.speed * dt;
      }
      if (state.keys.has('ArrowRight') || state.keys.has('d') || state.keys.has('D')) {
        p.x += p.speed * dt;
      }
      p.x = Math.max(0, Math.min(canvas.width - p.w, p.x));

      state.hazardSpawnTimer += dt;
      state.pickupSpawnTimer += dt;
      state.levelTimer += dt;

      const hazardInterval = Math.max(0.18, 0.9 - state.level * 0.06);
      const pickupInterval = 1.2;

      if (state.hazardSpawnTimer > hazardInterval) {
        spawnHazard();
        state.hazardSpawnTimer = 0;
      }

      if (state.pickupSpawnTimer > pickupInterval) {
        spawnPickup();
        state.pickupSpawnTimer = 0;
      }

      for (const h of state.hazards) {
        h.y += h.speed * dt;
        h.rotation += h.spin * dt;
      }

      for (const item of state.pickups) {
        item.y += item.speed * dt;
        item.bob += 5 * dt;
      }

      state.hazards = state.hazards.filter((h) => {
        if (rectOverlap(state.player, h)) {
          state.lives -= 1;
          updateUI();
          statusEl.textContent = state.lives > 0
            ? 'Ouch! That one got you. Keep moving!'
            : 'Wedgie wipeout! Tap Start to try again.';
          return false;
        }
        return h.y < canvas.height + h.h;
      });

      state.pickups = state.pickups.filter((item) => {
        if (rectOverlap(state.player, item)) {
          state.score += 15;
          updateUI();
          return false;
        }
        return item.y < canvas.height + item.h;
      });

      state.score += dt * 4;

      if (state.levelTimer > 12) {
        state.level += 1;
        state.levelTimer = 0;
        statusEl.textContent = `Level ${state.level}! Things are getting chaotic.`;
        updateUI();
      }

      if (state.lives <= 0) {
        state.running = false;
      }
    }

    function render() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      for (const h of state.hazards) {
        drawHazard(h);
      }
      for (const item of state.pickups) {
        drawPickup(item);
      }
      drawPlayer();
      drawHud();
    }

    function gameLoop(now) {
      const dt = Math.min((now - state.lastFrame) / 1000, 0.033);
      state.lastFrame = now;

      if (state.running) {
        update(dt);
        render();
        requestAnimationFrame(gameLoop);
      } else {
        render();
      }
    }

    window.addEventListener('keydown', (e) => {
      state.keys.add(e.key);
    });

    window.addEventListener('keyup', (e) => {
      state.keys.delete(e.key);
    });

    startBtn.addEventListener('click', resetGame);

    render();
  </script>
</body>
</html>
